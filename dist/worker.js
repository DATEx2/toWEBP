(()=>{var w=(a,t)=>()=>(t||a((t={exports:{}}).exports,t),t.exports);var f=w(()=>{self.onmessage=async function(a){let{id:t,file:n,quality:h}=a.data;try{if(n.type==="image/svg+xml")throw new Error("SVG detected - requesting main thread conversion");let e=await createImageBitmap(n),o=Math.min(480,e.height),b=o/e.height,r=e.width*b,c=new OffscreenCanvas(r,o);c.getContext("2d").drawImage(e,0,0,r,o);let d=await c.convertToBlob({type:"image/webp",quality:.65}),i=new FileReader,u=await new Promise(p=>{i.onloadend=()=>p(i.result),i.readAsDataURL(d)});self.postMessage({type:"thumb",id:t,thumbnail:u});let l=new OffscreenCanvas(e.width,e.height);l.getContext("2d").drawImage(e,0,0);let s=a.data.format||"image/webp",g={type:s};(s==="image/jpeg"||s==="image/webp"||s==="image/avif")&&(g.quality=h);let m=await l.convertToBlob(g);e.close(),self.postMessage({type:"result",id:t,success:!0,blob:m,originalSize:n.size,newSize:m.size})}catch(e){console.debug("Worker conversion skipped/failed, requesting fallback:",e.message),self.postMessage({type:"fallback",id:t,error:e.toString()})}}});f();})();
